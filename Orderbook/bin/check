#!/bin/bash +x

DIR=$(cd $(dirname $0)/..; pwd)

if [ ! -f dist/pricer.jar ]; then
  ant
fi
if [ ! -f $DIR/share/pricer.in.gz ]; then
  bin/download
fi

$DIR/bin/pricer 200 < $DIR/share/small.in > /dev/null
if [ $? -ne 0 ]; then
  exit $?
fi

diff $DIR/share/small.out.200 <($DIR/bin/pricer 200 < $DIR/share/small.in)
for i in 1 200 10000
do
  time diff --brief <(gzip -dc $DIR/share/pricer.in.gz | $DIR/bin/pricer $i) <(gzip -dc $DIR/share/pricer.out.$i.gz) || echo "Failed $i"
done

